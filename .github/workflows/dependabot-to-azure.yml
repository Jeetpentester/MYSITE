name: Create Azure Work Item for Dependabot Alerts

on:
  pull_request:
    types: [opened, reopened]
    branches:
      - main

jobs:
  create_azure_work_item:
    if: github.actor == 'dependabot[bot]'
    runs-on: ubuntu-latest
    steps:
      - name: Create Azure DevOps Work Item
        run: |
          curl -u :${{ secrets.AZURE_DEVOPS_PAT }} \
            -X POST \
            -H "Content-Type: application/json-patch+json" \
            -d @work-item.json \
            https://dev.azure.com/devsecopsjeet/MYSITE/_apis/wit/workitems/$Task?api-version=6.0
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
        shell: bash
        working-directory: .github/scripts